{% extends "base.html" %}

{% block title %}YouTube Analysis Tool - Home{% endblock %}

{% block head %}
<style>
    #customPromptSection {
        display: none;
    }
    .prompt-options {
        margin-bottom: 15px;
    }
    .prompt-info {
        cursor: pointer;
        color: #0d6efd;
        font-size: 0.9em;
    }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Analyze YouTube Content</h2>
            </div>
            <div class="card-body">
                <p class="card-text">
                    Enter a YouTube URL below to download, transcribe, and analyze the content.
                    The tool will extract key insights and investment opportunities mentioned in the video.
                </p>
                
                <form method="POST" action="{{ url_for('index') }}">
                    {{ form.hidden_tag() }}
                    <div class="mb-3">
                        {{ form.url.label(class="form-label") }}
                        {{ form.url(class="form-control", placeholder="https://www.youtube.com/watch?v=...") }}
                        {% if form.url.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.url.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        {{ form.model.label(class="form-label") }}
                        {{ form.model(class="form-select") }}
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Analysis Options</h5>
                        </div>
                        <div class="card-body">
                            <div class="prompt-options">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="promptType" id="defaultPrompt" value="default" checked>
                                    <label class="form-check-label" for="defaultPrompt">
                                        Use Default Analysis Prompt
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="promptType" id="templatePrompt" value="template">
                                    <label class="form-check-label" for="templatePrompt">
                                        Select Prompt Template
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="promptType" id="customPrompt" value="custom">
                                    <label class="form-check-label" for="customPrompt">
                                        Write Custom Prompt
                                    </label>
                                </div>
                            </div>

                            <div id="templateSection" class="mb-3" style="display: none;">
                                {{ form.prompt_template.label(class="form-label") }}
                                {{ form.prompt_template(class="form-select") }}
                                <div class="form-text mt-1">
                                    <a href="{{ url_for('prompts') }}" target="_blank">View all available templates</a>
                                </div>
                            </div>

                            <div id="customPromptSection" class="mb-3">
                                {{ form.custom_prompt.label(class="form-label") }}
                                {{ form.custom_prompt(class="form-control") }}
                                <div class="form-text">
                                    Use <code>{video_title}</code> and <code>{transcript}</code> as placeholders in your custom prompt.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="text-center">
                        {{ form.submit(class="btn btn-primary btn-lg") }}
                    </div>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h3 class="card-title">How It Works</h3>
            </div>
            <div class="card-body">
                <ol>
                    <li><strong>Download</strong> - We download the audio from the YouTube video.</li>
                    <li><strong>Transcribe</strong> - The audio is transcribed using OpenAI's Whisper model.</li>
                    <li><strong>Analyze</strong> - The transcript is analyzed using a powerful language model to extract insights.</li>
                    <li><strong>Results</strong> - You'll receive a detailed analysis with investment opportunities and risks.</li>
                </ol>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h3 class="card-title">Recent Analyses</h3>
            </div>
            <div class="card-body">
                <p>
                    View your <a href="{{ url_for('history') }}">analysis history</a> to see previously analyzed videos.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle prompt type radio buttons
        const radios = document.querySelectorAll('input[name="promptType"]');
        const templateSection = document.getElementById('templateSection');
        const customPromptSection = document.getElementById('customPromptSection');
        
        // Function to update sections visibility
        function updateSections() {
            const selectedValue = document.querySelector('input[name="promptType"]:checked').value;
            
            if (selectedValue === 'template') {
                templateSection.style.display = 'block';
                customPromptSection.style.display = 'none';
                document.getElementById('prompt_template').setAttribute('required', 'required');
                document.getElementById('custom_prompt').removeAttribute('required');
            } else if (selectedValue === 'custom') {
                templateSection.style.display = 'none';
                customPromptSection.style.display = 'block';
                document.getElementById('custom_prompt').setAttribute('required', 'required');
                document.getElementById('prompt_template').removeAttribute('required');
            } else {
                // Default
                templateSection.style.display = 'none';
                customPromptSection.style.display = 'none';
                document.getElementById('prompt_template').removeAttribute('required');
                document.getElementById('custom_prompt').removeAttribute('required');
            }
        }
        
        // Add event listeners to radio buttons
        radios.forEach(radio => {
            radio.addEventListener('change', updateSections);
        });
        
        // Initial setup
        updateSections();
    });
</script>
{% endblock %}